!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var s,r,h;!function(i,n){"use strict";"object"==typeof t.exports?t.exports=n(i):(r=[],void 0===(h="function"==typeof(s=n)?s.apply(e,r):s)||(t.exports=h))}("undefined"!=typeof window?window:this,(function(t){var e=function(t,e){return Math.ceil(Math.random()*e)+t},i=[],s=Math.pow,r=document.createElement("canvas");r.width=r.height=5;var h=r.getContext("2d"),n=function(t,e,i){this.x=t,this.y=e,this.step=1,this.ctx=i,this.init()};n.prototype.init=function(){var t,i,n,o,a,c,d,l,u,p,g;this.imageData=(t="#"+Math.floor(16777215*Math.random()).toString(16)+"aa",r.width=r.width,h.fillStyle=t,h.arc(2.5,2.5,2.5,0,2*Math.PI),h.fill(),h.getImageData(0,0,10,10)),this.paraCurve=(i=this.x,n=this.y,o=i+(e(0,10)>5?1:-1)*e(3,30),a=n-e(10,30),c=(a-n)/s(i-o,2),d=-2*o*c,l=c*s(o,2)+a,p=n-(u=function(t){return c*s(t,2)+d*t+l})(i),(g=function(t){var e=u(t)+p;return e=2*n-e}).dir=o>i?1:-1,g),this.step=1.8*this.paraCurve.dir},n.prototype.draw=function(){if(this.x+=this.step,this.y=this.paraCurve(this.x),this.y>document.body.clientHeight){let t=i.indexOf(this);i.splice(t,1)}else this.ctx.putImageData(this.imageData,this.x,this.y)};var o=function(t){requestAnimationFrame(()=>{t.width=t.width,function(){for(var t=i.length-1;t>=0;t--){i[t].draw()}}(),o(t)})};return function(t){this.canvas=t;var e=t.getContext("2d");t.height=document.body.clientHeight,t.width=document.body.clientWidth,e.strokeStyle="red",e.lineWidth=1,document.body.addEventListener("click",(function(t){!function(t,e,s){for(var r=0;r<15;r++)i.push(new n(t,e,s))}(t.clientX,t.clientY,e)})),o(t),console.log(this.canvas)}}))},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"RectSource",(function(){return S})),i.d(s,"Anchor",(function(){return x}));var r={};function h(t){return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}i.r(r),i.d(r,"SVGRender",(function(){return j})),i.d(r,"CanvasRender",(function(){return j})),i.d(r,"RenderBase",(function(){return l}));const n={isFunction:h("Function"),isArray:h("Array"),uuid:(t=10)=>{let e=[];for(var i=0;i<t;i++)e.push(Math.ceil(57*Math.random())+65);return String.fromCharCode.apply(String,e)},counterFactory:(t=0,e=1)=>function(){return t+e++}},o=(t,e,i)=>{t.addEventListener(e,i)},a=(t,e,i)=>{t.removeEventListener(e,i)};class c{constructor(){this.listener={},this.bridgeListener={}}on(t,e,i){return(this.listener[t]||(this.listener[t]=[])).push({name:t,fn:e,context:i}),this}once(t,e,i){var s=this.listener[t]||(this.listener[t]=[]),r=this;return s.push({name:t,fn:function s(){var h=e.apply(i||this,arguments);return r.off(t,s),h},context:i}),this}off(t,e,i){if(this.bridgeListener[t]=[],t)if(e)for(var s=this.listener[t]||(this.listener[t]=[]),r=s.length-1;r>=0;r--){var h=s[r];h.fn!==e&&h.context!==i||s.splice(r,1)}else this.listener[t]=[];else this.listener={};return this}emit(t){for(var e=this.listener[t]||(this.listener[t]=[]),i=this.bridgeListener[t]||[],s=arguments.length,r=new Array(s>1?s-1:0),h=1;h<s;h++)r[h-1]=arguments[h];for(var n=0,o=e.length;n<o;n++){var a=e[n],c=a.fn,d=a.context;c.apply(d,r)}for(o=i.length,n=0;n<o;n++){var l=i[n];l.emmiter.emit.apply(l.emmiter,[l.name].concat(r))}return this}bridge(t,e,i){return i||(i=t),(this.bridgeListener[t]||(this.bridgeListener[t]=[])).push({name:i,emmiter:e}),this}}const d=(t,e="")=>t?t+e:"100%";class l{constructor(t){this.shapes=[],this.$contaner=this.createElemet(t),this.$contaner.style.cssText=(t=>{let e=[];return e.push("width:"+d(t.width)),e.push("height:"+d(t.height)),e.push("position:relative"),e.join(";")})(t),t.el&&t.el.appendChild(this.$contaner),this.shapes=[]}add(t){return this.has()||this.shapes.push(t),t}remove(t){let e=this.shapes.indexOf(t);this.shapes.splice(e,1)}has(t){return this.shapes.indexOf(t)>-1}createElemet(){return document.createElement("div")}mount(t){this.$contaner&&t.appendChild(this.$contaner)}render(){}}const u=(t,e="")=>t?t+e:"100%",p=t=>{switch(t[0]){case"M":case"m":return t[0]+" "+t.slice(1).join(",");case"a":return[t[0],t.slice(1,3),t[3],t.slice(4,6),t.slice(6)].join(" ");default:return t.join(" ")}},g=(t,e,i)=>{t["__"+e]!==i&&(t.setAttribute(e,i),t["__"+e]=i)},f=function(t){let{shape:e,style:i}=t,s=(t=>{let e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.style.position="absolute",e})(),r=document.createElementNS("http://www.w3.org/2000/svg","path");return s.update=function(t){let e=t.shape;((t,e)=>{var i,s,r;g(t,"width",u(e.width,"")),g(t,"height",u(e.height,"")),i=t,s="transform",r=`translate(${u(e.x,"px")}, ${u(e.y,"px")})`,i.style["__"+s]!==r&&(i.style[s]=r,i.style["__"+s]=r)})(s,e),g(r,"width",u(e.width,"")),g(r,"height",u(e.height,"")),g(r,"d",t.getPath().map(p).join(" ")),i.strokeWidth&&g(r,"stroke-width",i.strokeWidth),i.strokeColor&&g(r,"stroke",i.strokeColor),g(r,"fill",i.fillColor||"none")},s.update(t),s.appendChild(r),s};class y extends l{constructor(t){super(t)}bindEvent(t){let e=t;return["click","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseover"].forEach(i=>{o(t.el,i,e.emit.bind(e,i))}),e.on("update",this.render.bind(this)),t}add(t){return t.el||(t.el=function(t){switch(t.type){case"circle":case"rect":default:return f(t)}}(t),t.dirty(),this.bindEvent(t)),super.add(t)}remove(t){let e=this.shapes.indexOf(t);var i;this.shapes.splice(e,1),t.el&&((i=t.el).parentElement&&i.parentElement.removeChild(i),t.el=null)}render(){for(let t=0,e=this.shapes.length;t<e;t++){let e=this.shapes[t];e.el.parentElement||this.$contaner.appendChild(e.el),e.__dirty&&e.el.update(e),e.__dirty=!1}}}class m extends c{constructor(t){super(),this.x=t.x||0,this.y=t.y||0,this.anchor=[],this.id=t.id||n.uuid(),delete t.x,delete t.y}copy(){return this.constructor(this.config)}destory(){this.__render&&this.shape&&(this.__render.remove(this.shape),this.shape.off()),this.off()}}class _ extends c{constructor(t){super(),this.__dirty=!0,this.el=null,this.id=n.uuid(),this.path=[],this.type=t.type,this.shape=t.shape,this.style=t.style||{}}setPath(t){this.path=t}setShape(t,e){"string"==typeof t?this.shape[t]=e:Object.assign(this.shape,t),this.dirty()}setStyle(t,e){"string"==typeof t?this.style[t]=e:Object.assign(this.style,t),this.dirty()}getRectPath(){let t=this.shape,e=[];return e.push(["M",0,0]),e.push(["L",t.width,0]),e.push(["L",t.width,t.height]),e.push(["L",0,t.height]),e.push(["Z"]),e}getCircle(){let{shape:t,style:e}=this,i=t.width-2*e.strokeWidth,s=i/2,r=[];return r.push(["M",t.width/2,t.height/2]),r.push(["m",-s,0]),r.push(["a",s,s,0,1,0,i,0]),r.push(["a",s,s,0,1,0,-i,0]),r.push(["Z"]),r}getPolyline(){let{shape:t}=this,e=t.paths.map(([t,e])=>["L",t,e]);return e[0][0]="M",e}getPath(){switch(this.type){case"rect":return this.getRectPath();case"circle":return this.getCircle();case"polyline":return this.getPolyline()}}dirty(t){this.__dirty=!0,t||this.emit("update")}mount(t){t&&(this.el=t)}destroy(){this.off()}}class w extends m{constructor(t,e,i){super(i),this.target=e,this.source=t,this.target.addConnector(this),this.source.addConnector(this)}initEvent(){this.__refresh=this.refresh.bind(this),this.target.shape.on("update",this.__refresh),this.source.shape.on("update",this.__refresh)}updateAnchor(t,e){e&&e.off("update",this.__refresh),t.on("update",this.__refresh),this.refresh()}setSource(t){let e=this.source;this.source=t,this.updateAnchor(t,e)}setTarget(t){let e=this.target;this.target=t,this.updateAnchor(t,e)}render(){this.__render&&(this.shape||(this.shape=this.__render.add(this.toShape()),this.initEvent()))}getShape(){let t=this.target,e=this.source,i=e.getCenter(),s=t.getCenter(),[r,h]=[Math.min(t.x,e.x),Math.min(t.y,e.y)],[n,o]=[Math.max(t.x,e.x),Math.max(t.y,e.y)];return{x:r,y:h,width:n-r+i[0],height:o-h+i[1],paths:[[e.x-r+i[0],e.y-h+i[1]],[t.x-r+s[0],t.y-h+s[1]]]}}refresh(){this.shape&&this.shape.setShape(this.getShape())}toShape(){return this.shape||new _({type:"polyline",shape:this.getShape(),style:{strokeWidth:2,strokeColor:"red"}})}}class b{constructor(t){this.render=t.render||new y(t),this.render.mount(t.el),this.sourceList=[],this.anchorList=[],this.connectorList=[]}_pack(t){return t.__render=this.render,t.root=this,t}add(t){this.sourceList.push(this._pack(t)),this.anchorList.push(...t.anchor.map(this._pack.bind(this))),this.refresh()}getSource(t){return t}getConnector(t){return t}getAnchor(t){return this.anchorList.filter(e=>e.id===t)[0]}connect(t,e){e="string"==typeof e?this.getAnchor(e):e,t="string"==typeof t?this.getAnchor(t):t;let i=new w(t,e,{});return i.__render=this.render,this.connectorList.push(i),this.refresh(),i}refresh(){for(let t=0,e=this.sourceList.length;t<e;t++){this.sourceList[t].render()}for(let t=0,e=this.connectorList.length;t<e;t++)this.connectorList[t].render();this.render.render()}reRender(){this.render.refresh()}}const v=n.counterFactory(3e3);class x extends m{constructor(t,e){super(t),this.source=e,this.type=t.type,this.config=t,this.connectorList=[]}copy(){return new x({...this.config,x:this.x,y:this.y})}setBasePosition(t,e){let[i,s]=this.config.position;this.x=t+i,this.y=e+s,this.shape.setShape({x:this.x,y:this.y})}addConnector(t){this.connectorList.push(t)}initEvent(){let t=!1,e=null,i=null,[s,r]=[0,0],h=t=>{let i=s-(t.clientX||t.pageX),h=r-(t.clientY||t.pageY);e.setBasePosition(this.x-i,this.y-h)},n=t=>{let s=t.target.__targetAnchor;s&&(i.setTarget(s),this.root.connect(this,s),t.target.__targetAnchor=null),i.destory(),e.destory(),a(document.body,"mousemove",h),a(document.body,"mouseup",n)};this.shape.on("mousedown",t=>{t.stopPropagation(),e=new x({type:"circle",x:this.x,y:this.y,position:[0,0],width:10,height:10}),t.target.__anchor=this,i=new w(this,e,{}),e.__render=this.__render,i.__render=this.__render,e.render(),i.render(),s=t.clientX||t.pageX,r=t.clientY||t.pageY,o(document.body,"mousemove",h),o(document.body,"mouseup",n)}),this.shape.on("mouseover",e=>{e.target.__anchor&&e.target.__anchor.source===this.source||(t=!0)}),this.shape.on("mouseup",e=>{t&&(e.target.__targetAnchor=this)}),this.shape.on("mouseout",e=>{t=!1})}getCenter(){return[this.config.width/2,this.config.height/2]}toShape(){return this.shape||new _({type:this.type,shape:{x:this.x,y:this.y,width:this.config.width,height:this.config.height},style:{zIndex:v(),strokeWidth:this.config.borderWidth||0,strokeColor:this.config.borderColor||"black",fillColor:this.config.backgroundColor||"white",raduis:this.config.borderRaduis||0}})}render(){this.__render&&(this.shape||(this.shape=this.__render.add(this.toShape()),this.initEvent()))}}const C={type:"circle",width:20,height:20,borderColor:"blue",borderWidth:"1",backgroundColor:"red"};class S extends m{constructor(t){super(t),this.anchor=[],this.config=t,this.initAnchor(t),this.refresh()}copy(){let t=new S({...this.config,x:this.x,y:this.y});return t.anchor=this.anchor.map(e=>{let i=e.copy();return i.source=t,i}),t}addAnchor(t){t.__render=this.__render,this.anchor.push(t)}initAnchor(t){let e=t.anchor;delete t.anchor,e&&(e=((t,e,i)=>(t=n.isArray(t)?t:[t]).map(t=>((t="string"==typeof t?{position:t}:t).shape=Object.assign({},C,t.shape||{}),t.__position=t.position,t.position=((t,e,i,s)=>{let r=e.width/2,h=e.height/2;switch(t){case"top":return[i/2-r,-h];case"right":return[i-r,s/2-h];case"bottom":return[i/2-r,s-h];case"left":return[-r,s/2-h]}})(t.position,t.shape,e,i),t)))(e,this.config.width,this.config.height),e.forEach(t=>{let[e,i]=t.position;t.shape.x=e+this.x,t.shape.y=i+this.y,t.shape.position=t.position,t.shape.id=t.id,t.shape.__position=t.__position,this.addAnchor(new x(t.shape,this))}))}getAnchorPoint(t){let{shape:{shape:e}}=t,i=[e.width/2,e.height/2];switch(t.config.__position){case"right":{let t=[i,[e.width/2+10,e.height/2]];return{start:t[1],paths:t}}case"bottom":{let t=[i,[e.width/2,e.height/2+10]];return{start:t[1],paths:t}}default:return{start:[0,0],paths:[[0,0]]}}}refresh(){this.__render&&this.__render.render()}initEvent(){let[t,e,i,s]=[0,0,this.x,this.y];const r=r=>{let h=t-(r.clientX||r.pageX),n=e-(r.clientY||r.pageY);this.x=i-h,this.y=s-n,this.anchor.map(t=>{t.setBasePosition(this.x,this.y)}),this.shape.setShape({x:this.x,y:this.y})},h=t=>{a(document.body,"mousemove",r),a(document.body,"mouseup",h)};this.shape.on("mousedown",n=>{t=n.clientX||n.pageX,e=n.clientY||n.pageY,i=this.x,s=this.y,console.log(t,e),o(document.body,"mousemove",r),o(document.body,"mouseup",h)})}render(){if(this.__render){this.shape||(this.shape=this.__render.add(this.toShape()),this.initEvent());for(let t=0,e=this.anchor.length;t<e;t++){this.anchor[t].render()}}}toShape(){return this.shape||new _({type:"rect",shape:{x:this.x,y:this.y,width:this.config.width,height:this.config.height},style:{strokeWidth:this.config.borderWidth||0,strokeColor:this.config.borderColor||"black",fillColor:this.config.backgroundColor||"white",raduis:this.config.borderRaduis||0}})}}const k=(t,e="")=>t?t+e:"100%",E=(t,e,i)=>t["__"+e]!==i&&(t.setAttribute(e,i),t["__"+e]=i,!0),L=(t,e,i)=>t.style["__"+e]!==i&&(t.style[e]=i,t.style["__"+e]=i,!0),P=(t,e,i,s)=>!(t["__"+e]===i&&!s)&&(t[e]=i,t["__"+e]=i,!0),M={M(t,e){this.moveTo(t,e),M.cache.call(this,t,e)},m(t,e){t+=this.__x||0,e+=this.__y||0,M.M.call(this,t,e)},a(t,e,i,s,r,h,n){this.__x,this.__y,this.ellipse&&this.ellipse(10,10,t,e,0,i/180*Math.PI,Math.PI/180,!r)},L(t,e){this.lineTo(t,e),M.cache.call(this,t,e)},Z(){this.closePath(),this.fill()},cache(t,e){this.__x=t,this.__y=e}},A=()=>{let t=document.createElement("canvas"),e=t.getContext("2d");return t.update=i=>{let{shape:s,style:r}=i;e.clearRect(0,0,s.width,s.height);let h=E(t,"width",s.width+20),n=E(t,"height",s.height+20);L(t,"width",k(s.width+20,"")),L(t,"height",k(s.height+20,"")),r.strokeWidth&&P(e,"lineWidth",r.strokeWidth,h||n),r.strokeColor&&P(e,"strokeStyle",r.strokeColor,h||n),P(e,"fillStyle",r.fillColor||"none"),((t,e)=>{let i=e.getPath();for(let e=0,s=i.length;e<s;e++){let s=i[e][0];M[s].apply(t,i[e].slice(1))}t.stroke()})(e,i)},t.__ctx=e,t};class j extends l{constructor(t){super(t),this.initEvent()}getEventShapes(t){let e=[];for(let i=0,s=this.shapes.length;i<s;i++){let s=this.shapes[i];s.el.__ctx.isPointInPath(t.offsetX-s.shape.x,t.offsetY-s.shape.y)&&e.push(s)}return e.reverse()}_handleEvent(t,e){let i=this.getEventShapes(e),s=e.stopPropagation||function(){},r=!1;e.stopPropagation=function(){s.apply(e,arguments),r=!0};for(let s=0,h=i.length;s<h&&(i[s].emit(t,e),!r);s++);}initEvent(){["click","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseover"].forEach(t=>{o(this.$contaner,t,this._handleEvent.bind(this,t))})}createElemet(t){let e=document.createElement("canvas");return e.width=t.width,e.height=t.height,this.ctx=e.getContext("2d"),e}add(t){return t.el||(t.el=A(),t.dirty(),t.on("update",this.render.bind(this))),super.add(t)}remove(t){super.remove(t),t.el&&this.render()}render(){this.$contaner.width=this.$contaner.width;for(let t=0,e=this.shapes.length;t<e;t++){let e=this.shapes[t];e.__dirty&&e.el.update(e),this.ctx.drawImage(e.el,e.shape.x,e.shape.y),e.__dirty=!1}}}var W={init:function(t){return new b(t)},...s,...r},O=i(0),R=i.n(O);window.onload=function(){let t=W.init({el:document.getElementById("container_svg")});window.plumbInst=t;let e=new W.RectSource({width:100,height:100,x:100,y:100,borderColor:"red",borderWidth:2,backgroundColor:"rgba(0,0,0,0.1)",borderRaduis:5,anchor:["top",{position:"right",id:"source-right"}]});console.log("source",e),t.add(e);let i=new W.RectSource({width:100,height:100,x:300,y:300,borderColor:"red",borderWidth:2,backgroundColor:"rgba(0,0,0,0.1)",borderRaduis:5,anchor:[{position:"left"},{position:"bottom",id:"target-bottom",shape:{type:"rect",borderColor:"blue",borderWidth:"1",backgroundColor:"blue"}}]});t.add(i),t.connect("source-right","target-bottom");let s=W.init({el:document.getElementById("container_canvas"),render:new W.CanvasRender({width:800,height:800})});s.add(e.copy()),s.add(i.copy()),s.connect("source-right","target-bottom"),window.plumbCanvas=s,new R.a(document.getElementsByClassName("click-animation")[0])}}]);